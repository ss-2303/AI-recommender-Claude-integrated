(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var I="https://book-recommender-jura.onrender.com/";class B{constructor(){this.routes={},this.currentView=null,window.addEventListener("hashchange",()=>this.handleRoute()),window.addEventListener("load",()=>this.handleRoute())}addRoute(t,n){this.routes[t]=n}navigate(t){window.location.hash=t}handleRoute(){const t=window.location.hash.substring(1)||"main",n=this.routes[t];n?(n(),this.currentView=t):this.navigate("main")}getCurrentView(){return this.currentView}}const c=new B;function E(e){document.getElementById("loginView").classList.add("hidden"),document.getElementById("mainView").classList.add("hidden");const t=document.getElementById(e);t&&t.classList.remove("hidden")}c.addRoute("main",()=>E("mainView"));c.addRoute("login",()=>E("loginView"));function w(){try{const e=localStorage.getItem("bookRecommenderUser");return e?JSON.parse(e):null}catch{return null}}function x(){localStorage.removeItem("bookRecommenderUser"),v(),c.navigate("main")}function v(){const e=w(),t=document.getElementById("loggedOutNav"),n=document.getElementById("loggedInNav"),d=document.getElementById("userGreeting");e?(t.classList.add("hidden"),n.classList.remove("hidden"),n.classList.add("flex"),d.textContent=`Hello, ${e.name}! ðŸ‘‹`):(n.classList.add("hidden"),n.classList.remove("flex"),t.classList.remove("hidden"))}function L(){v(),document.getElementById("loginBtn").addEventListener("click",function(){c.navigate("login")}),document.getElementById("logoutBtn").addEventListener("click",function(){x()}),document.getElementById("loginForm").addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("nameInput").value.trim();t&&(localStorage.setItem("bookRecommenderUser",JSON.stringify({name:t,loginTime:new Date().toISOString()})),v(),c.navigate("main"),document.getElementById("nameInput").value="")}),document.getElementById("backToMainBtn").addEventListener("click",function(){c.navigate("main")})}function m(e){document.getElementById("status").innerText=e}function T(){document.getElementById("loadingSpinner").classList.remove("hidden")}function b(){document.getElementById("loadingSpinner").classList.add("hidden")}function N(e,t,n){var d=document.getElementById("modalOverlay"),o=document.getElementById("modalTitle"),i=document.getElementById("modalAuthor"),r=document.getElementById("modalBody");o.innerText=e||"Details",i.innerText=t?"by "+t:"",r.innerText=n||"",d.classList.remove("hidden"),d.classList.add("flex")}function y(){var e=document.getElementById("modalOverlay");e.classList.add("hidden"),e.classList.remove("flex")}document.getElementById("modalCloseBtn").addEventListener("click",y);document.getElementById("modalOverlay").addEventListener("click",function(e){e.target.id==="modalOverlay"&&y()});document.addEventListener("keydown",function(e){e.key==="Escape"&&y()});function C(){for(var e=document.getElementById("results");e.firstChild;)e.removeChild(e.firstChild)}function O(e,t,n,d,o){var i=document.getElementById("results"),r=document.createElement("li");if(r.className="flex gap-4 rounded-xl border border-gray-200 bg-white p-4 shadow-sm",d){var l=document.createElement("img");l.className="h-28 w-20 rounded-md object-cover flex-none",l.src=d,l.alt=e||"Book cover",l.onerror=function(){l.remove()},r.appendChild(l)}var a=document.createElement("div");a.className="min-w-0";var u=document.createElement("div");if(u.className="text-base font-semibold text-gray-900",u.innerText=e||"(No title)",a.appendChild(u),t){var f=document.createElement("div");f.className="text-sm text-gray-600",f.innerText=t,a.appendChild(f)}if(n){var g=document.createElement("div");g.className="mt-2 text-sm text-gray-700 leading-relaxed line-clamp-2",g.innerText=n,a.appendChild(g);var s=document.createElement("button");s.className="mt-1 text-sm font-medium text-blue-600 hover:underline",s.innerText="Read more",s.onclick=function(){N(e,t,n)},a.appendChild(s)}if(typeof o=="number"){var h=document.createElement("div");h.className="mt-2 text-xs text-gray-500",h.innerText="Similarity: "+o.toFixed(3),a.appendChild(h)}r.appendChild(a),i.appendChild(r)}function p(e){C(),m("");var t=setTimeout(function(){T()},900);fetch(I+"/api/recommend?title="+encodeURIComponent(e),{method:"GET"}).then(function(n){if(!n.ok)throw new Error("HTTP "+n.status);return n.json()}).then(function(n){var d=n&&n.recommendations?n.recommendations:[];if(d.length===0){m("No recommendations found. Try a different title/keyword.");return}m("Top recommendations:"),console.log("First rec:",d[0]),d.forEach(function(o){O(o.title,o.author,o.description,o.cover_image,o.score)})}).catch(function(n){m("Error: "+n.message)}).finally(function(){clearTimeout(t),b()})}document.getElementById("goBtn").addEventListener("click",function(){var e=document.getElementById("titleInput").value;p(e)});document.getElementById("titleInput").addEventListener("keydown",function(e){if(e.key==="Enter"){var t=document.getElementById("titleInput").value;p(t)}});L();
